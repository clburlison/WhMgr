<br>
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="/dashboard/configs">Configs</a></li>
        <li class="breadcrumb-item active" aria-current="page">New Config</li>
    </ol>
</nav>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{title}}</h1>
</div>

<form method="POST" action="">
    <div class="accordion" id="accordionPanelsStayOpenExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingGeneral">
                <button class="accordion-button bg-dark text-light" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseGeneral" aria-expanded="true" aria-controls="panelsStayOpen-collapseGeneral">
                    General
                </button>
            </h2>
            <div id="panelsStayOpen-collapseGeneral" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingGeneral">
                <div class="accordion-body">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="name" value="{{name}}" required>
                    </div>
                    <div class="mb-3">
                        <label for="host" class="form-label">Host</label>
                        <input type="text" class="form-control" id="host" name="host" value="{{config.listeningHost}}" required>
                    </div>
                    <div class="mb-3">
                        <label for="port" class="form-label">Port</label>
                        <input type="number" class="form-control" id="port" name="port" value="{{config.webhookPort}}" min="0" max="65535" required>
                    </div>
                    <div class="mb-3">
                        <label for="locale" class="form-label">Locale</label>
                        <select class="form-control" id="locale" name="locale" required>
                            {{#each locales}}
                            <option value="{{.}}" {{isSelected this ../config.locale}}>{{.}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="maxPokemonId" class="form-label">Max Pokemon ID</label>
                        <input type="number" class="form-control" id="maxPokemonId" name="maxPokemonId" value="{{config.maxPokemonId}}" required>
                    </div>
                    <div class="mb-3">
                        <label for="despawnTimeMinimumMinutes" class="form-label">Despawn Time Minimum (Minutes)</label>
                        <input type="number" class="form-control" id="despawnTimeMinimumMinutes" name="despawnTimeMinimumMinutes" value="{{config.despawnTimeMinimumMinutes}}">
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="checkForDuplicates" {{#if config.checkForDuplicates}}checked{{/if}}>
                            <label class="form-check-label" for="checkForDuplicates">Check For Duplicates</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingShortUrlApi">
              <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseShortUrlApi" aria-expanded="false" aria-controls="panelsStayOpen-collapseShortUrlApi">
                Short Url API
              </button>
            </h2>
            <div id="panelsStayOpen-collapseShortUrlApi" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingShortUrlApi">
                <div class="accordion-body">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="shortUrlApiEnabled" {{#if config.shortUrlApi.enabled}}checked{{/if}}>
                        <label class="form-check-label" for="shortUrlApiEnabled">Enabled</label>
                    </div>
                    <div class="mb-3">
                        <label for="shortUrlApiUrl" class="form-label">API Url</label>
                        <input type="text" class="form-control" id="shortUrlApiUrl" name="shortUrlApiUrl" value="{{config.shortUrlApi.apiUrl}}" {{#unless config.shortUrlApi.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="shortUrlApiSignature" class="form-label">Signature</label>
                        <input type="text" class="form-control" id="shortUrlApiSignature" name="shortUrlApiSignature" value="{{config.shortUrlApi.signature}}" {{#unless config.shortUrlApi.enabled}}disabled{{/unless}}>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingStripe">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseStripe" aria-expanded="false" aria-controls="panelsStayOpen-collapseStripe">
                    Stripe API
                </button>
            </h2>
            <div id="panelsStayOpen-collapseStripe" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingStripe">
                <div class="accordion-body">
                    <div class="mb-3">
                        <label for="stripeApiKey" class="form-label">API Key</label>
                        <input type="text" class="form-control" id="stripeApiKey" name="stripeApiKey" value="{{config.stripeApi.apiKey}}">
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingServers">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseServers" aria-expanded="false" aria-controls="panelsStayOpen-collapseServers">
                    Discord Servers
                </button>
            </h2>
            <div id="panelsStayOpen-collapseServers" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingServers">
                <div class="accordion-body">
                    <div class="mb-3">
                    <label for="discordServers" class="form-label">Discord Server Configs</label>
                        <select class="form-control" id="discordServers" name="discordServers" multiple>
                            {{#each discords}}
                            <option value="{{this}}" {{isSelected ../config.serverConfigFiles this}}>{{this}}</option>
                            {{/each}}
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingDatabase">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseDatabase" aria-expanded="false" aria-controls="panelsStayOpen-collapseDatabase">
                    Databases
                </button>
            </h2>
            <div id="panelsStayOpen-collapseDatabase" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingDatabase">
                <div class="accordion-body">
                    <div class="card">
                        <div class="card-header bg-dark text-light">
                            Main Database
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="dbMainHost" class="form-label">Host</label>
                                <input type="text" class="form-control" id="dbMainHost" name="dbMainHost" value="{{config.database.main.host}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbMainPort" class="form-label">Port</label>
                                <input type="number" class="form-control" id="dbMainPort" name="dbMainPort" value="{{config.database.main.port}}" min="0" max="65535">
                            </div>
                            <div class="mb-3">
                                <label for="dbMainUsername" class="form-label">Username</label>
                                <input type="text" class="form-control" id="dbMainUsername" name="dbMainUsername" value="{{config.database.main.username}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbMainPassword" class="form-label">Password</label>
                                <input type="text" class="form-control" id="dbMainPassword" name="dbMainPassword" value="{{config.database.main.password}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbMainDatabase" class="form-label">Database</label>
                                <input type="text" class="form-control" id="dbMainDatabase" name="dbMainDatabase" value="{{config.database.main.database}}">
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="card">
                        <div class="card-header bg-dark text-light">
                            Scanner Database
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="dbScannerHost" class="form-label">Host</label>
                                <input type="text" class="form-control" id="dbScannerHost" name="dbScannerHost" value="{{config.database.scanner.host}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbScannerPort" class="form-label">Port</label>
                                <input type="number" class="form-control" id="dbScannerPort" name="dbScannerPort" value="{{config.database.scanner.port}}" min="0" max="65535">
                            </div>
                            <div class="mb-3">
                                <label for="dbScannerUsername" class="form-label">Username</label>
                                <input type="text" class="form-control" id="dbScannerUsername" name="dbScannerUsername" value="{{config.database.scanner.username}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbScannerPassword" class="form-label">Password</label>
                                <input type="text" class="form-control" id="dbScannerPassword" name="dbScannerPassword" value="{{config.database.scanner.password}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbScannerDatabase" class="form-label">Database</label>
                                <input type="text" class="form-control" id="dbScannerDatabase" name="dbScannerDatabase" value="{{config.database.scanner.database}}">
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="card">
                        <div class="card-header bg-dark text-light">
                            Nests Database
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="dbNestsHost" class="form-label">Host</label>
                                <input type="text" class="form-control" id="dbNestsHost" name="dbNestsHost" value="{{config.database.nests.host}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbNestsPort" class="form-label">Port</label>
                                <input type="number" class="form-control" id="dbNestsPort" name="dbNestsPort" value="{{config.database.nests.port}}" min="0" max="65535">
                            </div>
                            <div class="mb-3">
                                <label for="dbNestsUsername" class="form-label">Username</label>
                                <input type="text" class="form-control" id="dbNestsUsername" name="dbNestsUsername" value="{{config.database.nests.username}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbNestsPassword" class="form-label">Password</label>
                                <input type="text" class="form-control" id="dbNestsPassword" name="dbNestsPassword" value="{{config.database.nests.password}}">
                            </div>
                            <div class="mb-3">
                                <label for="dbNestsDatabase" class="form-label">Database</label>
                                <input type="text" class="form-control" id="dbNestsDatabase" name="dbNestsDatabase" value="{{config.database.nests.database}}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingUrls">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseUrls" aria-expanded="false" aria-controls="panelsStayOpen-collapseUrls">
                    Urls
                </button>
            </h2>
            <div id="panelsStayOpen-collapseUrls" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingUrls">
                <div class="accordion-body">
                    <label for="scannerMapUrl" class="form-label">Scanner Map Url</label>
                    <input type="text" class="form-control" id="scannerMapUrl" name="scannerMapUrl" value="{{config.urls.scannerMap}}">
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingEventPokemon">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseEventPokemon" aria-expanded="false" aria-controls="panelsStayOpen-collapseEventPokemon">
                    Event Pokemon
                </button>
            </h2>
            <div id="panelsStayOpen-collapseEventPokemon" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingEventPokemon">
                <div class="accordion-body">
                    <div class="mb-3">
                        <label for="eventPokemonIds" class="form-label">Pokemon IDs</label>
                        <input type="text" class="form-control" id="eventPokemonIds" name="eventPokemonIds" value="{{config.eventPokemon.pokemonIds}}">
                    </div>
                    <div class="mb-3">
                        <label for="eventPokemonMinIV" class="form-label">Minimum IV</label>
                        <input type="number" class="form-control" id="eventPokemonMinIV" name="eventPokemonMinIV" value="{{config.eventPokemon.minimumIV}}" min="0" max="100">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="eventPokemonFilterType">Filter Type</label>
                        <select class="form-control" id="eventPokemonFilterType" name="eventPokemonFilterType">
                            <option value="Include" {{isSelected config.eventPokemon.filterType "Include"}}>Include</option>
                            <option value="Exclude" {{isSelected config.eventPokemon.filterType "Exclude"}}>Exclude</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingIconStyles">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseIconStyles" aria-expanded="false" aria-controls="panelsStayOpen-collapseIconStyles">
                    Icon Styles
                </button>
            </h2>
            <div id="panelsStayOpen-collapseIconStyles" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingIconStyles">
                <div class="accordion-body">
                ...
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingStaticMaps">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseStaticMaps" aria-expanded="false" aria-controls="panelsStayOpen-collapseStaticMaps">
                    Static Maps
                </button>
            </h2>
            <div id="panelsStayOpen-collapseStaticMaps" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingStaticMaps">
                <div class="accordion-body">
                    {{#each config.staticMaps}}
                        <div class="card mb-3">
                            <div class="card-header bg-dark text-light">
                                {{@key}}
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="staticMap-{{url}}" class="form-label">Url</label>
                                    <input type="text" class="form-control" id="staticMap-{{@key}}-url" name="staticMap-{{@key}}-url" value="{{url}}">
                                </div>
                                <div class="mb-3">
                                    <label for="staticMap-{{templateName}}" class="form-label">Template Name</label>
                                    <input type="text" class="form-control" id="staticMap-{{@key}}-name" name="staticMap-{{@key}}-name" value="{{templateName}}">
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="staticMap-{{@key}}-" name="staticMap-{{@key}}-pokestops" {{#if includeNearbyPokestops}}checked{{/if}}>
                                        <label class="form-check-label" for="staticMap-{{@key}}-">Include Nearby Pokestops</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="staticMap-{{@key}}-" name="staticMap-{{@key}}-gyms" {{#if includeNearbyGyms}}checked{{/if}}>
                                        <label class="form-check-label" for="staticMap-{{@key}}-">Include Nearby Gyms</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {{/each}}
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingTwilio">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwilio" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwilio">
                    Twilio
                </button>
            </h2>
            <div id="panelsStayOpen-collapseTwilio" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwilio">
                <div class="accordion-body">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="twilioEnabled" name="twilioEnabled" {{#if config.twilio.enabled}}checked{{/if}}>
                        <label class="form-check-label" for="twilioEnabled">Enabled</label>
                    </div>
                    <div class="mb-3">
                        <label for="twilioAccountSid" class="form-label">Account SID</label>
                        <input type="text" class="form-control" id="twilioAccountSid" name="twilioAccountSid" value="{{config.twilio.accountSid}}" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="twilioAuthToken" class="form-label">Auth Token</label>
                        <input type="text" class="form-control" id="twilioAuthToken" name="twilioAuthToken" value="{{config.twilio.authToken}}" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="twilioFromNumber" class="form-label">From Number</label>
                        <input type="tel" class="form-control" id="twilioFromNumber" name="twilioFromNumber" value="{{config.twilio.fromNumber}}" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="twilioUserIds" class="form-label">User IDs</label>
                        <input type="text" class="form-control" id="twilioUserIds" name="twilioUserIds" value="{{config.twilio.userIds}}" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="twilioRoleIds" class="form-label">Role IDs</label>
                        <input type="text" class="form-control" id="twilioRoleIds" name="twilioRoleIds" value="{{config.twilio.roleIds}}" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="twilioPokemonIds" class="form-label">Pokemon IDs</label>
                        <input type="text" class="form-control" id="twilioPokemonIds" name="twilioPokemonIds" value="{{config.twilio.pokemonIds}}" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                    <div class="mb-3">
                        <label for="twilioMinIV" class="form-label">Minimum IV</label>
                        <input type="number" class="form-control" id="twilioMinIV" name="twilioMinIV" value="{{config.twilio.minimumIV}}" min="0" max="100" {{#unless config.twilio.enabled}}disabled{{/unless}}>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingReverseGeocoding">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseReverseGeocoding" aria-expanded="false" aria-controls="panelsStayOpen-collapseReverseGeocoding">
                    Reverse Geocoding
                </button>
            </h2>
            <div id="panelsStayOpen-collapseReverseGeocoding" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingReverseGeocoding">
                <div class="accordion-body">
                    <div class="mb-3">
                        <label for="provider" class="form-label">Provider</label>
                        <select class="form-control" id="provider" name="provider">
                            <option value="google" {{isSelected config.reverseGeocoding.provider "gmaps"}}>Google</option>
                            <option value="osm" {{isSelected config.reverseGeocoding.provider "osm"}}>OpenStreetMaps</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="cacheToDisk" name="cacheToDisk" {{#if config.reverseGeocoding.cacheToDisk}}checked{{/if}}>
                            <label class="form-check-label" for="cacheToDisk">Cache To Disk</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="card">
                            <div class="card-header bg-dark text-light">
                                Google Maps
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="gmapsKey" class="form-label">Key</label>
                                    <input type="text" class="form-control" id="gmapsKey" name="gmapsKey" value="{{config.reverseGeocoding.googleMaps.key}}">
                                </div>
                                <div class="mb-3">
                                    <label for="gmapsSchema" class="form-label">Schema</label>
                                    <input type="text" class="form-control" id="gmapsSchema" name="gmapsSchema" value="{{config.reverseGeocoding.googleMaps.schema}}">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="card">
                            <div class="card-header bg-dark text-light">
                                Nominatim
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="nominatimEndpoint" class="form-label">Endpoint</label>
                                    <input type="text" class="form-control" id="nominatimEndpoint" name="nominatimEndpoint" value="{{config.reverseGeocoding.nominatim.endpoint}}">
                                </div>
                                <div class="mb-3">
                                    <label for="nominatimSchema" class="form-label">Schema</label>
                                    <input type="text" class="form-control" id="nominatimSchema" name="nominatimSchema" value="{{config.reverseGeocoding.nominatim.schema}}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="panelsStayOpen-headingDiagnostics">
                <button class="accordion-button bg-dark text-light collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseDiagnostics" aria-expanded="false" aria-controls="panelsStayOpen-collapseDiagnostics">
                    Diagnostics
                </button>
            </h2>
            <div id="panelsStayOpen-collapseDiagnostics" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingDiagnostics">
                <div class="accordion-body">
                    <div class="mb-3">
                        <label for="logLevel" class="form-label">Log Level</label>
                        <select class="form-control" id="logLevel" name="logLevel">
                            <option value="0" {{isSelected config.logLevel "Trace"}}>Trace</option>
                            <option value="1" {{isSelected config.logLevel "Debug"}}>Debug</option>
                            <option value="2" {{isSelected config.logLevel "Info"}}>Info</option>
                            <option value="3" {{isSelected config.logLevel "Warning"}}>Warning</option>
                            <option value="4" {{isSelected config.logLevel "Error"}}>Error</option>
                            <option value="5" {{isSelected config.logLevel "Critical"}}>Critical</option>
                            <option value="6" {{isSelected config.logLevel "None"}}>None</option>
                        </select>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="debug" name="debug" {{#if config.debug}}checked{{/if}}>
                        <label class="form-check-label" for="debug">Log incoming webhook data</label>
                    </div>
                    <span class="badge bg-warning text-dark">Warning: Only use for debugging</span>
                </div>
            </div>
        </div>
    </div>
    <br>
    <button type="submit" class="btn btn-primary">Save</button>
</form>

<script type="text/javascript">
    const shortUrlProperties = [
        '#shortUrlApiUrl',
        '#shortUrlApiSignature',
    ];
    const twilioProperties = [
        '#twilioAccountSid',
        '#twilioAuthToken',
        '#twilioFromNumber',
        '#twilioUserIds',
        '#twilioRoleIds',
        '#twilioPokemonIds',
        '#twilioMinIV',
    ];

    $('#shortUrlApiEnabled').on('click', () => disableElements('#shortUrlApiEnabled', shortUrlProperties));
    $('#twilioEnabled').on('click', () => disableElements('#twilioEnabled', twilioProperties));

    function disableElements(selector, properties) {
        const element = $(selector);
        const value = element.is(':checked');
        for (const property of properties) {
            $(property).prop('disabled', !value);
        }
    }
</script>